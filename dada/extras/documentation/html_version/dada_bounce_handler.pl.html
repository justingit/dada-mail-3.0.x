<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Mystery Girl - Bounce Handler</title>
<link rel="stylesheet" href="/Users/justin/Documents/DadaMail/build/tmp/dada/extras/documentation/pod_source/pod_styles.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@omen.apple.com" />
</head>

<body>

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<li><a href="#obtaining_a_copy_of_this_program">OBTAINING A COPY OF THIS PROGRAM</a></li>
	<li><a href="#requirements">REQUIREMENTS</a></li>
	<li><a href="#recommended">RECOMMENDED</a></li>
	<li><a href="#lightning_configuration_installation_instructions">Lightning Configuration/Installation Instructions</a></li>
	<li><a href="#configuration">CONFIGURATION</a></li>
	<li><a href="#installation">INSTALLATION</a></li>
	<ul>

		<li><a href="#telling_dada_mail_to_use_the_bounce_handler_">Telling Dada Mail to use the Bounce Handler.</a></li>
		<ul>

			<li><a href="#if_you_re_using_th_sendmail_command_">If you're using th sendmail command:</a></li>
			<li><a href="#if_you_re_using_smtp_sending_">If you're using SMTP sending:</a></li>
		</ul>

		<li><a href="#testing">Testing</a></li>
	</ul>

	<li><a href="#configurating_the_cronjob_to_automatically_run_mystery_girl">Configurating the Cronjob to Automatically Run Mystery Girl</a></li>
	<ul>

		<li><a href="#setting_the_cronjob">Setting the cronjob</a></li>
		<ul>

			<li><a href="#_plugin_config__allow_manual_run_">$Plugin_Config-&gt;{Allow_Manual_Run}</a></li>
			<li><a href="#security_concerns_and__plugin_config__manual_run_passcode_">Security Concerns and $Plugin_Config-&gt;{Manual_Run_Passcode}</a></li>
			<li><a href="#other_options_you_may_pass">Other options you may pass</a></li>
			<li><a href="#notes_on_setting_the_cronjob_for_curl">Notes on Setting the Cronjob for curl </a></li>
		</ul>

	</ul>

	<li><a href="#command_line_interface">Command Line Interface</a></li>
	<ul>

		<li><a href="#command_line_interface_for_cronjobs_">Command Line Interface for Cronjobs: </a></li>
		<ul>

			<li><a href="#_1_change_the_lib_path">#1 Change the lib path</a></li>
		</ul>

		<li><a href="#_2_set_the_cron_job">#2 Set the cron job </a></li>
	</ul>

	<li><a href="#how_mystery_girl_works">How Mystery Girl Works</a></li>
	<ul>

		<li><a href="#mystery_girl_s_webbased_control_panel">Mystery Girl's Web-Based Control Panel</a></li>
		<ul>

			<li><a href="#bounce_email_scorecard">Bounce Email Scorecard</a></li>
			<li><a href="#manually_run_mystery_girl">Manually Run Mystery Girl</a></li>
			<li><a href="#mystery_girl_configuration">Mystery Girl Configuration</a></li>
		</ul>

	</ul>

	<li><a href="#advanced_configuration__rules__rule_">Advanced Configuration: Rules, Rule! </a></li>
	<li><a href="#more_on_scores__thresholds__etc">More on Scores, Thresholds, etc</a></li>
	<li><a href="#faqs">FAQs</a></li>
	<li><a href="#thanks">Thanks</a></li>
	<li><a href="#copyright">COPYRIGHT</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<hr />
<h1><a name="name">NAME</a></h1>
<p>Mystery Girl - A Bounce Handler For Dada Mail</p>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>Mystery Girl intelligently handles bounces from Dada Mail list messages.</p>
<p>Mystery Girl hooks into your Dada Mail mailing lists indirectly. You'll first need to create a new POP3 email address which will be used to send all bounces from the Dada Mail lists. This address is known as your <strong>Bounce Email Address</strong></p>
<p>The login information for this account will be set in Mystery Girl.</p>
<p>This same address will also be set in the <strong>Return-Path</strong> of messages sent by Dada Mail. Thus, when a message is bounced, it gets sent to this address, which is monitored by Mystery Girl. Hazzah.</p>
<p>Once Mystery Girl connects to this  POP3 acccount, awaiting messages are first <strong>read</strong>, then, the message is <strong>parsed</strong>, in an attempt to understand why the message has bounced.</p>
<p>The parsed email will then be <strong>examined</strong> and an <strong>action</strong> will be taken. The examination and action are set in
a collection of <strong>rules</strong>.  These rules can be tweaked, added, removed
and generally mucked about with.</p>
<p>The usual action that is taken is to apply a, <strong>score</strong> to the offending email address, everytime the address bounces back a message. Once the, <strong>Threshold</strong> is reached, the email address is unsubscribed from the list.</p>
<p>This usually means that it takes a few bounces from a particular email address to get it removed from a list. This gives a bit of wiggle room and makes sure an email address that is bouncing is bouncing for a fairly good reason, for example: it no longer exists.</p>
<p>
</p>
<hr />
<h1><a name="obtaining_a_copy_of_this_program">OBTAINING A COPY OF THIS PROGRAM</a></h1>
<p>Mystery Girl is located in the, <em>dada/plugins</em> directory of the main Dada Mail distribution, under the name, <strong>dada_bounce_handler.pl</strong></p>
<p>
</p>
<hr />
<h1><a name="requirements">REQUIREMENTS</a></h1>
<p>These points are absolutely necessary. Please make sure you have them before you try to install this plugin:</p>
<ul>
<li><strong><a name="item_dada_mail_3">Dada Mail 3</a></strong>

<p>Basically, use the version of Mystery Girl that comes with the version of Dada 
Mail you're running.</p>
</li>
<li><strong><a name="item_a_pop3_email_account">A POP3 Email Account</a></strong>

<p>Mystery Girl works by checking a bounce email address via the POP3 protocol.</p>
<p>You will need to setup a new email address for Mystery Girl to check. I usually set up an account named, <a href="mailto:``bounces@yourdomain.com'',">``bounces@yourdomain.com'',</a> where, ``yourdomain.com'' is the name of the domain Dada Mail is installed on.</p>
<p>Some things to consider:</p>
<ul>
<li><strong><a name="item_do_not_use_this_address_for_anything_but_mystery_g">Do NOT use this address for anything but Mystery Girl's functions</a></strong>

<p>Meaning: don't periodically check it yourself via a mail reader. Doing so will not break Dada Mail, but it will stop Mystery Girl from working correctly. Why? Because sometimes checking a POP3 address will download the messages awaiting in the POP3 Inbox and remove them from this inbox. If you need to periodically check this inbox, make sure to have your mail reader set to <strong>not</strong> automatically remove the mssages.</p>
</li>
<li><strong><a name="item_the_email_address_must_belong_to_the_domain_you_ha">The email address MUST belong to the domain you have Dada Mail installed</a></strong>

<p>Meaning, if your domain is, ``yourdomain.com'', the bounce email address should be something like, <a href="mailto:``bounces@yourdomain.com''.">``bounces@yourdomain.com''.</a> In other words, do not use a Yahoo! Gmail, or Hotmail account for your bounce address. This will most likely disrupt all regular mail sending in Dada Mail.</p>
</li>
<li><strong><a name="item_mystery_girl_must_be_able_to_check_the_pop3_accoun">Mystery Girl MUST be able to check the POP3 account</a></strong>

<p>Sometimes, it can't - there may be a block for connections to port 110 from connections that come from your hosting account server.</p>
</li>
</ul>
</ul>
<p>
</p>
<hr />
<h1><a name="recommended">RECOMMENDED</a></h1>
<p>These points are not required, but recommended to have to use Mystery Girl:</p>
<ul>
<li><strong><a name="item_ability_to_set_cron_jobs_2e">Ability to set Cron Jobs.</a></strong>

<p>Mystery Girl can be configured to run automatically by using a cron tab - In Other Words: a scheduled task.</p>
<p>If you do not know how to set up a cron job, attempting to set one up for Dada Mail will result in much aggravation. Please read up on the topic before attempting!</p>
</li>
<li><strong><a name="item_shell_access_to_your_hosting_account">Shell Access to Your Hosting Account</a></strong>

<p>Shell Access is sometimes required to set up a cronjob, using the:</p>
<pre>
 crontab -e</pre>
<p>command. You may also be able to set up a cron tab using a web-based control panel tool, like Cpanel.</p>
<p>Shell access also facilitates testing of the program.</p>
</li>
</ul>
<p>
</p>
<hr />
<h1><a name="lightning_configuration_installation_instructions">Lightning Configuration/Installation Instructions</a></h1>
<p>To get to the point:</p>
<ul>
<li><strong><a name="item_create_the_bounce_handler_email_account">Create the bounce handler email account</a></strong>

<li><strong><a name="item_set_your_list_to_use_this_address_for_its_2c__22li">Set your list to use this address for its, ``List Administrator Address'' in the list control panel, under, Manage list - Change List Information.</a></strong>

<li><strong><a name="item_open_up_the_dada_bounce_handler_2epl_script_in_a_t">Open up the dada_bounce_handler.pl script in a text editor.</a></strong>

<li><strong><a name="item_set_the_pop3_server_2c_username_and_password_2e_sa">Set the POP3 server, username and password. Save.</a></strong>

<li><strong><a name="item_upload_the_dada_bounce_handler_2epl_script_into_th">Upload the dada_bounce_handler.pl script into the cgi-bin/dada/plugins directory</a></strong>

<li><strong><a name="item_chmod_755_the_dada_bounce_handler_2epl_script">chmod 755 the dada_bounce_handler.pl script</a></strong>

<li><strong><a name="item_run_the_plugin_via_a_web_browser_2e">run the plugin via a web browser.</a></strong>

<li><strong><a name="item_cronjob">Set the cronjob (optional)</a></strong>

</ul>
<p>Below is the detailed version of the above:</p>
<p>
</p>
<hr />
<h1><a name="configuration">CONFIGURATION</a></h1>
<p>There's a few things you need to configure in this script, they're all
at the top.</p>
<ul>
<li><strong><a name="item_pop3_server_information_2e">POP3 server information.</a></strong>

<p>Your bounce email address login information is saved in the, <strong>dada_bounce_handler.pl</strong> script itself -</p>
<p>Create a new POP3 email account. This email account will be the address that
bounced messages will be directed towards.</p>
<p>Change the following variables:</p>
<ul>
<li><strong><a name="item__plugin_config__server_">$Plugin_Config-&gt;{Server}</a></strong>

<li><strong><a name="item__plugin_config__username_">$Plugin_Config-&gt;{Username}</a></strong>

<li><strong><a name="item__plugin_config__password_">$Plugin_Config-&gt;{Password}</a></strong>

</ul>
<p>to reflect the permissions for the email address you're going to use
for the bounce handler.</p>
</ul>
<p>As far as required changes, we are done.</p>
<p>
</p>
<hr />
<h1><a name="installation">INSTALLATION</a></h1>
<p>Mystery Girl acts like a Dada Mail plugin.</p>
<p>Usually, you'll set up Dada Mail in your cgi-bin: in your cgi-bin, there's a directory called, ``dada''. Inside the, ``dada'' directory, there are at least two things, one called, ``DADA'' (uppercase) and the mail.cgi script.</p>
<p>In the, ``dada'' directory, create a new directory called, ``plugins''. Upload the dada_bounce_handler.pl script, already configured, into this directory. Change its permissions to, ``755''.  Visit the script in your web browser - the URL will look something like this:</p>
<pre>
        <a href="http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl">http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl</a></pre>
<p>To run the bounce handler on your bounced messages, click the, <strong>Parse Bounces...</strong> button.</p>
<p>If you would like have a link on the left hand side of the list control panel, find the following line in the Config.pm:</p>
<pre>
 #                                      {-Title      =&gt; 'Bounce Handler',
 #                                       -Title_URL  =&gt; $PLUGIN_URL.&quot;/dada_bounce_handler.pl&quot;,
 #                                       -Function   =&gt; 'dada_bounce_handler',
 #                                       -Activated  =&gt; 1,
 #                                      },</pre>
<p>And uncomment it (Take off the, ``#'' on each line).</p>
<p>Mystery Girl is now installed.</p>
<p>The last thing you will have to configure is your Dada Mail <strong>list administration email</strong> address.</p>
<p>
</p>
<h2><a name="telling_dada_mail_to_use_the_bounce_handler_">Telling Dada Mail to use the Bounce Handler.</a></h2>
<p>You're going to have to tell Dada Mail explicitly that you want
bounces to go to the bounce handler. The first step is to set the 
<strong>Dada List Administrator</strong> to your bounce email address. You'll set this per list in the each list's control panel, under <strong>Manage List - Change List Information</strong></p>
<p>After that, you'll need to configure outgoing email messages to set the <strong>Dada List Administrator</strong> address in the <code>Return-Path</code> header. Sounds scary, but it's easy enough.</p>
<p>
</p>
<h3><a name="if_you_re_using_th_sendmail_command_">If you're using th sendmail command:</a></h3>
<p>In the list control panel, go to <strong>Sending Options - Advanced</strong> and 
check: <strong>Add the Sendmail '-f' flag when sending messages ...</strong></p>
<p>This <em>should</em> set the sending to the admin email, and in turn, set the
<strong>Return-Path</strong> header. Dada Mail 3.0 is shipped to have this option set by default.</p>
<p>
</p>
<h3><a name="if_you_re_using_smtp_sending_">If you're using SMTP sending:</a></h3>
<p>In the list control panel, go to: <strong>Sending Options -</strong> SMTP settings&gt;
and check the box labeled: <strong>Set the Sender of SMTP mailings to the 
list administration email address</strong>  Dada Mail 3.0 is shipped to have this option set by default.</p>
<p>
</p>
<h2><a name="testing">Testing</a></h2>
<p>To test out any of these configurations, Send yourself a test message
and view the source of the message itself, in your mail reader. In the
mail headers, you should see the <strong>Return-Path</strong> header:</p>
<pre>
 Return-Path: &lt;dadabounce@myhost.com&gt;
 Delivered-To: justin@myhost.com
 Received: (qmail 75721 invoked from network); 12 May 2003 04:50:01 -0000
 Received: from myhost.com (208.10.44.140)
   by hedwig.myhost.com with SMTP; 12 May 2003 04:50:01 -0000
 Date:Sun, 11 May 2003 23:50:01 -0500
 From:justin &lt;justin@myhost.com&gt;
 Subject:Test, Test, Test
 To:justin@myhost.com
 Sender:dadabounce@myhost.com
 Reply-To:justin &lt;justin@myhost.com&gt;
 Precedence:list
 Content-type:text/plain; charset=iso-8859-1</pre>
<p>Notice that the first line has the <strong>Return-Path</strong> header, correctly
putting my bounce email address. My List Owner address, 
<a href="mailto:justin@myhost.com">justin@myhost.com</a> still occupies the To: and Reply-To headers, so 
whoever replies to my message will reply to me, not the bounce handler.</p>
<p>Once you've dialed in your list to use the bounce handler, you should
be all set.</p>
<p>
</p>
<hr />
<h1><a name="configurating_the_cronjob_to_automatically_run_mystery_girl">Configurating the Cronjob to Automatically Run Mystery Girl</a></h1>
<p>We're going to assume that you already know how to set up the actual cronjob, 
but we'll be explaining in depth on what the cronjob you need to set <strong>is</strong>.</p>
<p>
</p>
<h2><a name="setting_the_cronjob">Setting the cronjob</a></h2>
<p>Generally, setting the cronjob to have Mystery Girl run automatically, just 
means that you have to have a cronjob access a specific URL. The URL looks something like this:</p>
<pre>
 <a href="http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl?run=1&amp;verbose=1">http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl?run=1&amp;verbose=1</a></pre>
<p>Where, <a href="http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl">http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl</a> is the URL to your copy of dada_bounce_handler.pl</p>
<p>You'll see the specific URL used for your installation of Dada Mail in the web-based control panel for Mystery Girl, under the fieldset legend, <strong>Manually Run Mystery Girl</strong>, under the heading, <strong>Manual Run URL:</strong></p>
<p>This will have Mystery Girl check any awaiting messages.</p>
<p>You may have to look through your hosting account's own FAQ, Knowledgebase and/or other docs to see exactly how you invoke a URL via a cronjob.</p>
<p>A <em>Pretty Good Guess</em> of what the entire cronjob should be set to is located 
in the web-based crontrol panel for Mystery Girl, under the fieldset legend, <strong>Manually Run Mystery Girl</strong>, under the heading, <strong>curl command example (for a cronjob):</strong></p>
<p>From my testing, this should work for most Cpanel-based hosting accounts.</p>
<p>Here's the entire thing explained:</p>
<p>In all these examples, I'll be running the script every 5 minutes ( */5 * * * * ) - tailor to your taste.</p>
<ul>
<li><strong><a name="item_using_curl_3a">Using Curl:</a></strong>

<pre>
 */5 * * * * /usr/local/bin/curl -s --get --data run=1 --url <a href="http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl">http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl</a></pre>
<li><strong><a name="item_options">Using Curl, a few more options (we'll cover those in just a bit):</a></strong>

<pre>
 */5 * * * * /usr/local/bin/curl -s --get --data run=1\;verbose=0\;test=0\;messages=100 --url <a href="http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl">http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl</a></pre>
</ul>
<p>
</p>
<h3><a name="_plugin_config__allow_manual_run_">$Plugin_Config-&gt;{Allow_Manual_Run}</a></h3>
<p>If you <strong>DO NOT</strong> want to use this way of invoking the program to check awaiting messages and send them out, make sure to change the variable, <strong>$Plugin_Config-</strong>{Allow_Manual_Run}&gt; to, <strong>0</strong>:</p>
<pre>
 $Plugin_Config-&gt;{Allow_Manual_Run}    = 0;</pre>
<p>at the top of the dada_bounce_handler.pl script. If this variable is not set to, <strong>1</strong> this method will not work.</p>
<p>
</p>
<h3><a name="security_concerns_and__plugin_config__manual_run_passcode_">Security Concerns and $Plugin_Config-&gt;{Manual_Run_Passcode}</a></h3>
<p>Running the plugin like this is somewhat risky, as you're allowing an anonymous web browser to run the script in a way that was originally designed to only be run either after successfully logging into the list control panel, or, when invoking this script via the command line.</p>
<p>If you'd like, you can set up a simple <strong>Passcode</strong>, to have some semblence of security over who runs the program. Do this by setting the, <strong>$Plugin_Config-</strong>{Manual_Run_Passcode}&gt; variable in the dada_bounce_handler.pl source itself.</p>
<p>If you set the variable like so:</p>
<pre>
    $Plugin_Config-&gt;{Manual_Run_Passcode} = 'sneaky';</pre>
<p>You'll then have to change the URL in these examples to:</p>
<pre>
 <a href="http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl?run=1&amp;passcode=sneaky">http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl?run=1&amp;passcode=sneaky</a></pre>
<p>
</p>
<h3><a name="other_options_you_may_pass">Other options you may pass</a></h3>
<p>You can control quite a few things by setting variables right in the query string:</p>
<ul>
<li><strong><a name="item_passcode">passcode</a></strong>

<p>As mentioned above, the <strong>$Plugin_Config-</strong>{Manual_Run_Passcode}&gt; allows you to set some sort of security while running in this mode. Passing the actual password is done in the query string:</p>
<pre>
 <a href="http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl?run=1&amp;passcode=sneaky">http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl?run=1&amp;passcode=sneaky</a></pre>
</li>
<li><strong><a name="item_messages">messages</a></strong>

<p>Overrides <strong>$Plugin_Config-</strong>{MessagesAtOnce}&gt;. States how many messages should be checked and parsed in one execution of the program. Example:</p>
<pre>
  <a href="http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl?run=1&amp;messages=10">http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl?run=1&amp;messages=10</a></pre>
</li>
<li><strong><a name="item_verbose">verbose</a></strong>

<p>By default, you'll receive the a report of how Mystery Girl is doing parsing and adding scores (and what not). This is sometimes not so desired, especially in a cron environment, since all this informaiton will be emailed to you (or someone) everytime the script is run.  You can run Mystery Girl with a cron that looks like this:</p>
<pre>
 */5 * * * * /usr/local/bin/curl -s --get --data run=1 --url <a href="http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl">http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl</a> &gt;/dev/null 2&gt;&amp;1</pre>
<p>The, <code>&gt;/dev/null 2&gt;&amp;1</code> line throws away any values returned.</p>
<p>Since <strong>all</strong> the information being returned from the program is done sort of indirectly, this also means that any problems actually running the program will also be thrown away.</p>
<p>If you set <strong>verbose</strong> to, ``0'', under normal operation, Mystery Girl won't show any output, but if there's a server error, you'll receive an email about it. This is probably a good thing. Example: 

</p>
<pre>
 * * * * * /usr/local/bin/curl -s --get --data run=1\;verbose=0 --url <a href="http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl">http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl</a>

</pre>
</li>
<li><strong><a name="item_test">test</a></strong>

<p>Runs Mystery Girl in test mode by checking the bounces and parsing them, but not actually carrying out the Rules. 

</p>
</li>
</ul>
<p>
</p>
<h3><a name="notes_on_setting_the_cronjob_for_curl">Notes on Setting the Cronjob for curl</a></h3>
<p>You may want to check your version of <code>curl</code> and see if there's a speific way to pass a query string. For example, this: 

</p>
<pre>
 */5 * * * * /usr/local/bin/curl -s <a href="http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl?run=1&amp;passcode=sneaky">http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl?run=1&amp;passcode=sneaky</a>

</pre>
<p>Doesn't work for me. 

</p>
<p>I have to use the <code>--get</code> and <code>--data</code> flags, like this: 

</p>
<pre>
 */5 * * * * /usr/local/bin/curl -s --get --data run=1\;passcode=sneaky --url <a href="http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl">http://example.com/cgi-bin/dada/plugins/dada_bounce_handler.pl</a>

</pre>
<p>my query string is this part: 

</p>
<pre>
 run=1\;passcode=sneaky

</pre>
<p>And also note I had to escape the, <strong>;</strong> character. You'll probably have to do the same for the <strong>&amp;</strong> character. 

</p>
<p>Finally, I also had to pass the actual URL of the plugin using the <strong>--url</strong> flag. 

</p>
<p>
</p>
<hr />
<h1><a name="command_line_interface">Command Line Interface</a></h1>
<p>There's a slew of optional arguments you can give to this script. To use Mystery Girl via the command line, first change into the directory that Mystery Girl resides in, and issue the command: 

</p>
<pre>
 ./dada_bounce_handler.pl --help

</pre>
<p>For a full list of paramaters. 

</p>
<p>One of the reasons why you may want to run Mystery Girl via the command line is to set the cronjob via the command line interface, rather than the web-based way. Fair enough!

</p>
<p>
</p>
<h2><a name="command_line_interface_for_cronjobs_">Command Line Interface for Cronjobs:</a></h2>
<p>One reason that the web-based way of running the cronjob is better, is that it 
doesn't involve reconfiguring the plugin, every time you upgrade. This makes 
the web-based invoking a bit more convenient. 

</p>
<p>
</p>
<h3><a name="_1_change_the_lib_path">#1 Change the lib path</a></h3>
<p>You'll need to explicitly state where both the:

</p>
<ul>
<li><strong><a name="item_absolute_path_to_the_site_2dwide_perl_libraries">Absolute Path to the site-wide Perl libraries</a></strong>

<li><strong><a name="item_absolute_path_of_the_local_dada_mail_libraries">Absolute Path of the local Dada Mail libraries</a></strong>

</ul>
<p>I'm going to rush through this, since if you want to run Mystery Girl this way
you probably know the terminology, but: 

</p>
<p>This script will be running in a different environment and from a different location than what you'd run it as, when you visit it in a web-browser. It's annoying, but one of the things you have to do when running a command line script via a cronjob. 

</p>
<p>As an example: <code>use lib qw()</code> lines probably look like: 

</p>
<pre>
 use lib qw(
 
 ../ 
 ../DADA/perllib 
 ../../../../perl 
 ../../../../perllib 
 
 );

</pre>
<p>To this list, you'll want to append your site-wide Perl Libraries and the 
path to the Dada Mail libraries. 

</p>
<p>If you don't know where your site-wide Perl libraries are, try running this via the command line:

</p>
<pre>
 perl -e 'print $_ .&quot;\n&quot; foreach @INC'; 

</pre>
<p>If you do not know how to run the above command, visit your Dada Mail in a web browser, log into your list and on the left hand menu and: click, <strong>About Dada Mail</strong> 

</p>
<p>Under <strong>Script Information</strong>, click the, <strong> +/- More Information</strong> link and under the, <strong>Perl Library Locations</strong>, select each point that begins with a, ``/'' and use those as your site-wide path to your perl libraries. 

</p>
<p>
</p>
<h2><a name="_2_set_the_cron_job">#2 Set the cron job</a></h2>
<p>Cron Jobs are scheduled tasks. We need something to check your POP3 email account quite a bit. We're going to set a cron job to test for new messages every 5 minutes. Here's an example cron tab: 

</p>
<pre>
  */5  *  *  *  * /usr/bin/perl /home/myaccount/cgi-bin/dada/plugins/dada_bounce_handler.pl &gt;/dev/null 2&gt;&amp;1

</pre>
<p>Where, <em>/home/myaccount/cgi-bin/dada/plugins/dada_bounce_handler.pl</em> is the full path to the script we just configured. 

</p>
<p>
</p>
<hr />
<h1><a name="how_mystery_girl_works">How Mystery Girl Works</a></h1>
<p>Once you've set up and installed Mystery Girl correctly, bounced email messages 
now been set to be delivered to the email address that Mystery Girl checks - 
that is, the, <code>Return-Path</code> header has been set to the <strong>Bounce Email Address</strong>,
 which is also the address set for your <strong>List Admin Email Address</strong>. 

</p>
<p>When Mystery Girl checks each bounced email message, it'll attempt to figure 
out the severity of the bounce and score the email address belonging to the 
subscriber accordingly. 

</p>
<p>
</p>
<h2><a name="mystery_girl_s_webbased_control_panel">Mystery Girl's Web-Based Control Panel</a></h2>
<p>There's a few things you may also do in Mystery Girl's own control panel: 

</p>
<p>
</p>
<h3><a name="bounce_email_scorecard">Bounce Email Scorecard</a></h3>
<p>You can view the bounce email scorecard - the scores that Mystery Girl gives
to email addresses that are currently bouncing and haven't been unsubscribed
yet. 

</p>
<p>Selecting an email address (and clicking it) will give you a rundown of the 
bounce report for each bounce the email address creates. 

</p>
<p>
</p>
<h3><a name="manually_run_mystery_girl">Manually Run Mystery Girl</a></h3>
<p>If you like, you can run Mystery Girl whenever you like. Running Mystery Girl 
this way is a good way to see if everything is working correctly and give you 
an insight of how it all works. 

</p>
<p>
</p>
<h3><a name="mystery_girl_configuration">Mystery Girl Configuration</a></h3>
<p>View how Mystery Girl is configured. 

</p>
<p>
</p>
<hr />
<h1><a name="advanced_configuration__rules__rule_">Advanced Configuration: Rules, Rule!</a></h1>
<p>dada_bounce_handler.pl figures out what to do with the bounce messages
receives by consulting a group of rules. These rules are highly configurable, 
so if you need to change the behavior of this script, you don't have to 
change the code. 

</p>
<p>These rules are stored in the <strong>$Plugin_Config-\</strong>{Rules}&gt; hashref. An example rule:

</p>
<pre>
     {
        exim_user_unknown =&gt; { 
            Examine =&gt; { 
                Message_Fields =&gt; { 
                    Status      =&gt; [qw(5.x.y)], 
                    Guessed_MTA =&gt; [qw(Exim)],  
                }, 
                Data =&gt; { 
                    Email       =&gt; 'is_valid',
                    List        =&gt; 'is_valid', 
                }
            },
                Action =&gt; { 
                     add_to_score =&gt; $Plugin_Config-&gt;{Default_Hard_Bounce_Score},
                }, 
            }
    }, 

</pre>
<p><strong>exim_user_unknown</strong> is the title of the rule -  just a label, nothing else.

</p>
<p><strong>Examine</strong> holds a set of parameters that the handler looks at when
trying to figure out what to do with a bounced message. This example
has a <strong>Message_Fields</strong> entry and inside that, a <strong>Status</strong> entry. The
<strong>Status</strong> entry holds a list of status codes. The ones in shown there
all correspond to hard bounces; the mailbox probably doesn't exist. <strong>Message_Fields</strong> also hold a, <strong>Guessed_MTA</strong> entry - it's explicitly looking for a bounce back from the, <em>Exim</em> mail server. 

</p>
<p><strong>Examine</strong> also holds a <strong>Data</strong> entry, which holds the <strong>Email</strong> or <strong>List</strong> 
entries, or both. Their values are either 'is_valid', or 'is_invalid'. 

</p>
<p>So, to sum this all up, this rule will match a message that has <strong>Status:</strong> 
<strong>Message Field</strong> contaning a user unknown error code, <strong>(5.1.1, etc)</strong> and also a <strong>Guessed_MTA</strong> <strong>Message Field</strong> containing, <strong>Exim</strong>. The message
also has to be parsed to have found a valid email and list name. 

</p>
<p>Pretty Slick, eh? 

</p>
<p>If this all matches, the <strong>Action</strong> is... acted upon. In this case, the offending email address will be appended a, <strong>Bounce Score</strong> of, whatever, <strong>$Plugin_Config-</strong>{Default_Hard_Bounce_Score}&gt;, which is by default, <strong>4</strong>. 

</p>
<p>If you would like to have the bounced address automatically removed, without any sort of scoring happening, change the <strong>action</strong> from,

</p>
<pre>
    add_to_score =&gt; $Plugin_Config-&gt;{Default_Hard_Bounce_Score}

</pre>
<p>to: 

</p>
<pre>
    unsubscribe_bounced_email =&gt; 'from_list'

</pre>
<p>Also, changing <strong>from_list</strong>, to <strong>from_all_lists</strong> will do the trick. 

</p>
<p>I could change the line: 

</p>
<pre>
 unsubscribe_bounced_email =&gt; 'from_list', 

</pre>
<p>to: 

</p>
<pre>
 mail_list_owner =&gt; 'user_unknown_message'

</pre>
<p>This will, instead of deleting the email automatically, send a message 
to the list owner, stating that, ``Hey, the message bounced, what do you
want to do?'' 

</p>
<p>Another example: 

</p>
<pre>
 {
 over_quota =&gt; {
         Examine =&gt; {
                Message_Fields =&gt; {
                        Status =&gt; [qw(5.2.2)]
                },
                Data =&gt; { 
                        Email =&gt; 'is_valid', 
                        List  =&gt; 'is_valid',
                }
        },
        Action =&gt; { 
                mail_list_owner =&gt; 'over_quota_message', 
        },
 }                    

</pre>
<p>This time, I created a list for messages that get bounced because the
mailbox is full. This is still considered a hard bounce, but I don't
want the subscriber removed because they haven't check their inbox 
during the week. In this case, the <strong>Action</strong> has been set to: 

</p>
<pre>
 mail_list_owner =&gt; 'over_quota_message', 

</pre>
<p>Which will do what it sounds like, it'll mail the list owner a message
explaining the circumstances. 

</p>
<p>Here's a schematic of all the different things you can do: 

</p>
<pre>
 {
 rule_name =&gt; {
         Examine =&gt; {
                Message_Fields =&gt; {
                        Status               =&gt; qw([    ]), 
                        Last-Attempt-Date    =&gt; qw([    ]), 
                        Action               =&gt; qw([    ]), 
                        Status               =&gt; qw([    ]), 
                        Diagnostic-Code      =&gt; qw([    ]), 
                        Final-Recipient      =&gt; qw([    ]), 
                        Remote-MTA           =&gt; qw([    ]), 
                        # etc, etc, etc
                        
                },
                Data =&gt; { 
                        Email =&gt; 'is_valid' | 'is_invalid' 
                        List  =&gt; 'is_valid' | 'is_invalid' 
                }
        },
        Action =&gt; { 
                   add_to_score             =&gt;  $x, # where, &quot;$x&quot; is a number
                           mail_list_owner           =&gt; 'user_unknown_message', 
                           mail_list_owner           =&gt; 'email_not_found_message', 
                           mail_list_owner           =&gt; 'over_quota_message', 
                           unsubscribe_bounced_email =&gt; 'from_list' | 'from_all_lists',
        },
 },     

</pre>
<p>Mystery Girl also supports the use of regular expressions for matching any of the <strong>Message_Fields</strong>. To tell the parser that you're using a regular expression, make the Message_Field key end in '_regex': 

</p>
<pre>
 'Final-Recipient_regex' =&gt; [(qr/RFC822/)], 

</pre>
<p>Setting rules is sort of the super advanced part of the configuration,
but it may come in handy. 

</p>
<p>
</p>
<hr />
<h1><a name="more_on_scores__thresholds__etc">More on Scores, Thresholds, etc</a></h1>
<p>We talked about scoring, but not in great detail, so let's do that: 

</p>
<p>By default, The Bounce Handler assigns a particular score to each email address that bounces back a message. These scores are tallied each time an email address bounces a message.

</p>
<p>Since Dada Mail understands the differences between <strong>Hard Bounces</strong> and <strong>Soft Bounces</strong>, it'll append a smaller score for soft bounces, and a larger score for hard bounces. 

</p>
<p>Once the email address's <strong>Bounce Score</strong> reaches the <strong>Threshold</strong>, the email address is then removed from the list. 

</p>
<p>You can manipulate the Soft and Hard Bounce Scores and Threshold pretty easily. On the top of this script, you'll see the necessary variables to tweak, 

</p>
<ul>
<li><strong><a name="item__plugin_config__default_soft_bounce_score_">$Plugin_Config-&gt;{Default_Soft_Bounce_Score}</a></strong>

<li><strong><a name="item__plugin_config__default_hard_bounce_score_">$Plugin_Config-&gt;{Default_Hard_Bounce_Score}</a></strong>

<li><strong><a name="item__plugin_config__score_threshold_">$Plugin_Config-&gt;{Score_Threshold}</a></strong>

</ul>
<p>Fairly self-explanitory. 

</p>
<p>If you want even greater control over what kind of bounces give what scores, you can manipulate the <strong>Bounce Rules</strong> themselves, as described above. 

</p>
<p>Some things to understand: 

</p>
<p>If you would like to periodically erase the saved scores, you may do so, by running this script via the command line, like so: 

</p>
<pre>
    ./dada_bounce_handler.pl --erase_score_card

</pre>
<p>
</p>
<hr />
<h1><a name="faqs">FAQs</a></h1>
<ul>
<li><strong><a name="item_does_the_bounce_handler_differentiate_between__22h">Does the bounce handler differentiate between ``hard' bounces and 'soft' bounces?</a></strong>

<p>Yes. Because of the Rules, you can set what happens, depending on what 
type of bounce you receive. By default, the bounce handler is set up to think, ``hard bounces'' are email addresses that 
are  invalid because they simply don't exist, and
soft bounces as email addresses that because the email box
is full, or there was some sort of problem actually sending the message to the subscriber. 

</p>
<p>Dada Mail basically works by saying, <em>After x amount of bounces, just remove from the list.</em>

</p>
</li>
<li><strong><a name="item_i_keep_getting_2c__27permission_denied_27_errors_2">I keep getting, 'permission denied' errors, what's wrong?</a></strong>

<p>It's very possible that Mystery Girl can't read your subscription database or the list settings database. This is because Dada Mail may be running under the webserver's username, usually, <strong>nobody</strong>, and not what Mystery Girl is running under, usually your account username. 

</p>
<p>You'll need to do a few things: 

</p>
<ul>
<li><strong><a name="item_change_the_permissions_of_the_list_subscription_an">Change the permissions of the list subscription and settings databases</a></strong>

<p>You'll most likely need to change the permissions of these files to, '777'. PlainText subscription databases have the format of <strong>listshortname.list</strong> and are usually located where you set the <strong>$FILES</strong> Config file variable. .List settings Databases have the format of <strong>mj-listshortname</strong> and are usually located in the same location.

</p>
</li>
<li><strong><a name="item_change_the__24file_chmod_variable">Change the $FILE_CHMOD variable</a></strong>

<p>So you don't need to change the permissions of the list files for every new list you create, set the $FILE_CMOD Config variable to 0777:
	
 $FILE_CHMOD = 0777; 

</p>
<p>Notice there are no quotes around 0777. 

</p>
</li>
</ul>
<li><strong><a name="item_the_program_is_working_great_3b_but_bounces_aren_2">The program is working great; but bounces aren't being handled at all</a></strong>

<p>Make sure that you have checked, <strong>Print list-specific headers in all list emails</strong> in Sending Options -&gt; Advanced. Mystery Girl uses the <em>List</em> 
header to figure out what list the bounce is coming from.

</p>
</li>
<li><strong><a name="item_i_found_a_bug_in_this_program_2c_what_do_i_do_3f">I found a bug in this program, what do I do?</a></strong>

<p>Report it to the bug tracker: 

</p>
<p><a href="http://sourceforge.net/tracker/?group_id=13002&atid=113002">http://sourceforge.net/tracker/?group_id=13002&atid=113002</a>

</p>
</li>
<li><strong><a name="item_i_keep_getting_this_bounced_message_2c_but_mystery">I keep getting this bounced message, but Mystery Girl isn't handling it, what do I do?</a></strong>

<p>You'll most likely have to make a new rule for it. If you want, attach a copy of the bounced message to the bug tracker: 

</p>
<p><a href="http://sourceforge.net/tracker/?group_id=13002&atid=113002">http://sourceforge.net/tracker/?group_id=13002&atid=113002</a>

</p>
<p>And we'll see if we can't get that kind of bounce in a new version.

</p>
</li>
<li><strong><a name="item_what_27s_up_with_the_name_2c_mystery_girl_3f">What's up with the name, Mystery Girl?</a></strong>

<p>It's from a <em>Yeah Yeah Yeahs</em> song: <strong>Mystery Girl</strong>. A bounce handler
is sort of a mysterious tool, making decisions for you and a mysterious
girl just seems to be one full of power and allusion. The song itself 
is about rejecting a guy that just doesn't make it anymore, 
so that gives a good metaphor to  a bounced mail, in a slightly weird, 
nerdy, nerdy, nerdy... artsy way.   

</p>
<p>When the bounce handler emails a list owner, you can do nothing but
answer back to it. Yeah Yeah Yeah. 

</p>
<p><strong>(colophon)</strong> 

</p>
<p>Actually, the lyrics I'm thinking of aren't from the song, Mystery Girl, 
but from the song, ``Bang!'' off of the YYY's self titled release. Mystery Girl
is the next song on that album.  The song after that is one called,
``Art Star'', which is what I am in the daytime! The next song is 
called, ``Miles Away'', which is where you probably are to me. All this
in, ``Our Time'' (the last song) See? it's like this was all written in
the stars. 

</p>
<p><a href="http://yeahyeahyeahs.com">http://yeahyeahyeahs.com</a>

</p>
<p>Here's a small clip of the YYY's performing ``Mystery Girl'' at the Gothic on 11.20.03 that I took: 

</p>
<p><a href="http://dadamailproject.com/media/YYYs_Mystery_Girl_Clip.mov">http://dadamailproject.com/media/YYYs_Mystery_Girl_Clip.mov</a>

</p>
<p>hot!

</p>
</li>
</ul>
<p>
</p>
<hr />
<h1><a name="thanks">Thanks</a></h1>
<p>Thanks to: Jake Ortman Henry Hughes for some prelim bounce examples.

</p>
<p>Thanks to Eryq ( <a href="http://www.zeegee.com">http://www.zeegee.com</a> ) for the amazing MIME-tools
collection. It's a gnarly group of modules. 

</p>
<p>
</p>
<hr />
<h1><a name="copyright">COPYRIGHT</a></h1>
<p>Copyright (c) 1999-2008 Justin Simoni 
<a href="http://justinsimoni.com">http://justinsimoni.com</a> 
All rights reserved. 

</p>
<p>This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

</p>
<p>This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

</p>
<p>You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.

</p>
<p>Parts of this script were swiped from Mail::Bounce::Qmail module, fetched from here: 

</p>
<p><a href="http://mikoto.sapporo.iij.ad.jp/cgi-bin/cvsweb.cgi/fmlsrc/fml/lib/Mail/Bounce/Qmail.pm">http://mikoto.sapporo.iij.ad.jp/cgi-bin/cvsweb.cgi/fmlsrc/fml/lib/Mail/Bounce/Qmail.pm</a>

</p>
<p>The copyright of that code stated: 

</p>
<p>Copyright (C) 2001,2002,2003 Ken'ichi Fukamachi
All rights reserved. This program is free software; you can
redistribute it and/or modify it under the same terms as Perl itself.

</p>
<p>Thanks Ken'ichi

</p>

</body>

</html>
